
- name: set variables
  set_fact:
    python3_version: "3.5.4"
    python2_version: "2.7.14"

- name: git clone pyenv
  git:
    repo: https://github.com/pyenv/pyenv.git
    dest: "{{ home_dir }}/.pyenv"
    version: master

- name: add pyenv settings to bash_profile
  blockinfile:
    marker: "# {mark} ANSIBLE MANAGED BLOCK python role"
    dest: "{{ home_dir }}/.bash_profile"
    content: |
      export PYENV_ROOT="$HOME/.pyenv"
      export PATH="$PYENV_ROOT/bin:$PATH"
      eval "$(pyenv init -)"
  notify: source bash_profile

- shell: bash -lc "pyenv versions | grep {{ python3_version }}"
  register: pyenv_version
  ignore_errors: yes
  changed_when: False

- shell: bash -lc "pyenv install {{ python3_version }}"
  when: pyenv_version is failed

- shell: bash -lc "pyenv versions | grep {{ python2_version }}"
  register: pyenv2_version
  ignore_errors: yes
  changed_when: False

- shell: bash -lc "pyenv install {{ python2_version }}"
  when: pyenv2_version is failed

- name: set variables
  set_fact:
    ansible_python_interpreter: "{{ home_dir }}/.pyenv/shims/python2"
  when: pyenv2_version

- pip: name={{ item }}
  with_items:
    - neovim

- shell: bash -lc "pyenv global {{ python3_version }}"
  when: pyenv_version is failed

- name: set variables
  set_fact:
    ansible_python_interpreter: "{{ home_dir }}/.pyenv/shims/python3"
  when: pyenv_version

- pip: name={{ item }}
  with_items:
    - neovim
    - flake8
    - requests
    - mypy
    - autopep8
    - isort
    - yapf
    - lxml
    - python-language-server
    - websocket-client
    - websocket-server
    - vim-vint
